{% extends "supplier_ws/base.html" %}
{% set active = "parts" %}


{% block supplier_content %}

<!-- Filter Bar -->


<!-- KPI / Summary Cards -->
<!--<div class="grid grid-cols-12 gap-4 mb-5">-->
<!--  <div class="col-span-12 sm:col-span-6 lg:col-span-3">-->
<!--    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-4">-->
<!--      <div class="text-xs text-slate-500">Parts count</div>-->
<!--      <div class="mt-1 text-2xl font-semibold text-slate-900">{{ stats.total_parts }}</div>-->

<!--    </div>-->
<!--  </div>-->

<!--  <div class="col-span-12 sm:col-span-6 lg:col-span-3">-->
<!--    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-4">-->
<!--      <div class="text-xs text-slate-500"></div>-->
<!--      <div class="mt-1 text-2xl font-semibold text-slate-900">{{ stats.with_drawing }}</div>-->
<!--      <div class="mt-2 text-xs text-slate-400"></div>-->
<!--    </div>-->
<!--  </div>-->

<!--  <div class="col-span-12 sm:col-span-6 lg:col-span-3">-->
<!--    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-4">-->
<!--      <div class="text-xs text-slate-500"></div>-->
<!--      <div class="mt-1 text-2xl font-semibold text-slate-900">{{ stats.with_cp }}</div>-->
<!--      <div class="mt-2 text-xs text-slate-400"></div>-->
<!--    </div>-->
<!--  </div>-->

<!--  <div class="col-span-12 sm:col-span-6 lg:col-span-3">-->
<!--    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-4">-->
<!--      <div class="text-xs text-slate-500"></div>-->
<!--      <div class="mt-1 text-2xl font-semibold text-slate-900">{{ stats.need_update }}</div>-->
<!--      <div class="mt-2 text-xs text-slate-400"></div>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<!-- Table -->
<!-- Header Row (Search + Add) -->
<div class="flex items-center justify-between gap-3 mb-4">
  <!-- Search -->
  <form method="get" class="flex-1">
    <div class="relative max-w-xl">
      <input
        type="text"
        name="q"
        value="{{ q or '' }}"
        placeholder="搜索 PN / Description / Project ..."
        class="w-full rounded-2xl border border-slate-200 bg-white px-4 py-2.5
               text-sm text-slate-800 placeholder:text-slate-400
               focus:outline-none focus:ring-2 focus:ring-slate-300"
      />

    </div>
  </form>

  <!-- Add -->
  <a href="{{ url_for('parts.new_part', supplier_code=supplier.code) }}"
     class="rounded-xl bg-emerald-600 px-4 py-2.5 text-sm text-white hover:bg-emerald-700">
    + Add
  </a>
</div>



    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <!-- Header -->
        <thead class="bg-slate-50/70">
          <tr class="text-[12px] font-semibold text-slate-600">
            <th class="px-6 py-3 text-left">PN</th>
            <th class="px-6 py-3 text-left">Description</th>
            <th class="px-6 py-3 text-left">Project</th>
            <th class="px-6 py-3 text-left">Drawing</th>
            <th class="px-6 py-3 text-left">Control Plan</th>
            <th class="px-6 py-3 text-left">Status</th>
            <th class="px-6 py-3 text-left">Update</th>
            <th class="px-6 py-3 text-right">Action</th>
          </tr>
        </thead>

        <!-- Body -->
        <tbody class="divide-y divide-slate-100 bg-white">
          {% for p in parts %}
          <tr class="group hover:bg-slate-50/70 transition-colors">
            <!-- PN -->
            <td class="px-6 py-4">
              <div class="font-semibold text-slate-900 tracking-tight">
                {{ p.pn }}
              </div>

            </td>

            <!-- Description -->
            <td class="px-6 py-4">
              <div class="text-slate-700">
                {{ p.description or "-" }}
              </div>
            </td>

            <!-- Project -->
            <td class="px-6 py-4">
              <span class="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs text-slate-700">
                {{ p.project or "-" }}
              </span>
            </td>

            <!-- Drawing -->
            <td class="px-6 py-4">
              {% set cnt = p.drawings.count() %}
              <button
                type="button"
                class="inline-flex items-center rounded-full px-2.5 py-1 text-xs
                       {% if cnt>0 %}bg-emerald-50 text-emerald-700{% else %}bg-slate-100 text-slate-700{% endif %}"
                onclick="openDrawings('{{ supplier.code }}', {{ p.id }})"
              >
                {% if cnt>0 %}{{ cnt }} versions{% else %}未关联{% endif %}
              </button>
            </td>


            <!-- CP -->
            <td class="px-6 py-4">
              <span class="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs text-slate-700">
                未关联
              </span>
            </td>

            <!-- Status -->
            <td class="px-6 py-4">
              <span class="inline-flex items-center rounded-full bg-emerald-50 px-2.5 py-1 text-xs font-medium text-emerald-700">
                Active
              </span>
            </td>

            <!-- Update -->
            <td class="px-6 py-4 text-xs text-slate-400 whitespace-nowrap">
              {{ p.created_at.date() }}
            </td>

            <!-- Action -->
            <td class="px-6 py-4 text-right">
              <div class="inline-flex items-center gap-2">
                <a href="{{ url_for('parts.edit_part', supplier_code=supplier.code, part_id=p.id) }}"
                   class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700
                          hover:bg-slate-50 transition-colors">
                  Edit
                </a>

                <form method="post"
                      action="{{ url_for('parts.delete_part', supplier_code=supplier.code, part_id=p.id) }}"
                      onsubmit="return confirm('Delete this part?');">
                  <button
                    class="rounded-lg border border-rose-200 bg-rose-50 px-3 py-1.5 text-xs font-medium text-rose-700
                           hover:bg-rose-100 transition-colors">
                    Del.
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td class="px-6 py-10 text-center text-slate-500" colspan="8">
              暂无零部件。点击右侧 “+ Add” 开始录入。
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>


  <div class="px-5 py-4 border-t border-slate-100 flex items-center justify-between">
    <div class="text-sm text-slate-500">
      显示 1 - {{ parts|length }} / {{ parts|length }}
    </div>

    <div class="flex items-center gap-2">
      <button class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50">上一页</button>
      <button class="rounded-xl bg-slate-900 px-3 py-2 text-sm text-white">1</button>
      <button class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50">下一页</button>
    </div>
  </div>
</div>

{% endblock %}

{% extends "layout/base.html" %}
{% block content %}

<style>
  .task-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .task-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }
  .kanban-column {
    transition: all 0.3s ease;
  }
  .stat-card {
    transition: all 0.3s ease;
  }
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }
</style>

<div class="max-w-7xl mx-auto px-6 py-6">

  <!-- Header -->
  <div class="mb-8 flex items-center justify-between">
    <div>
      <h1 class="text-4xl font-bold text-gray-900 mb-2 tracking-tight">
        My Tasks
      </h1>
      <p class="text-base text-gray-500">Track and manage your daily work tasks</p>
    </div>

    <a href="{{ url_for('tasks.new_task') }}"
       class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-blue-500 text-white font-semibold
              hover:bg-blue-600 transition-all hover:scale-105 active:scale-95 shadow-lg shadow-blue-500/30">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
      </svg>
      New Task
    </a>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">

    <!-- Total Tasks -->
    <div class="stat-card bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
          </svg>
        </div>
      </div>
      <div class="text-3xl font-bold text-gray-900 mb-1">{{ stats.total }}</div>
      <div class="text-sm text-gray-500 font-medium">Total</div>
    </div>

    <!-- Urgent -->
    <div class="stat-card bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
        </div>
      </div>
      <div class="text-3xl font-bold text-gray-900 mb-1">{{ stats.urgent }}</div>
      <div class="text-sm text-gray-500 font-medium">Urgent</div>
    </div>

    <!-- In Progress -->
    <div class="stat-card bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </div>
      </div>
      <div class="text-3xl font-bold text-gray-900 mb-1">{{ stats.in_progress }}</div>
      <div class="text-sm text-gray-500 font-medium">In Progress</div>
    </div>

    <!-- Due Today -->
    <div class="stat-card bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>
      <div class="text-3xl font-bold text-gray-900 mb-1">{{ stats.due_today }}</div>
      <div class="text-sm text-gray-500 font-medium">Due Today</div>
    </div>

    <!-- Overdue -->
    <div class="stat-card bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>
      <div class="text-3xl font-bold text-gray-900 mb-1">{{ stats.overdue }}</div>
      <div class="text-sm text-gray-500 font-medium">Overdue</div>
    </div>
  </div>

  <!-- View Toggle & Filters -->
  <div class="flex items-center justify-between mb-6">
    <!-- View Toggle -->
    <div class="flex items-center gap-2 bg-white rounded-xl border border-gray-300 p-1 shadow-sm">
      <button onclick="switchView('kanban')" id="btn-kanban"
              class="px-4 py-2 rounded-lg font-semibold text-sm transition-all bg-blue-500 text-white shadow-sm">
        <svg class="w-4 h-4 inline mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>
        </svg>
        Board
      </button>
      <button onclick="switchView('list')" id="btn-list"
              class="px-4 py-2 rounded-lg font-semibold text-sm text-gray-600 hover:bg-gray-100 transition-all">
        <svg class="w-4 h-4 inline mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
        List
      </button>
    </div>

    <!-- Filters -->
    <div class="flex items-center gap-3">
      <select onchange="filterTasks(this.value)"
              class="px-4 py-2 border border-gray-300 rounded-xl text-sm font-semibold
                     focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 cursor-pointer
                     shadow-sm bg-white">
        <option value="">All Priorities</option>
        <option value="urgent">Urgent</option>
        <option value="high">High</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>

      <select onchange="filterByCategory(this.value)"
              class="px-4 py-2 border border-gray-300 rounded-xl text-sm font-semibold
                     focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 cursor-pointer
                     shadow-sm bg-white">
        <option value="">All Categories</option>
        <option value="quality_issue">Quality Issue</option>
        <option value="supplier_audit">Supplier Audit</option>
        <option value="documentation">Documentation</option>
        <option value="training">Training</option>
        <option value="meeting">Meeting</option>
        <option value="other">Other</option>
      </select>
    </div>
  </div>

  <!-- Kanban Board View -->
  <div id="kanban-view" class="grid grid-cols-1 md:grid-cols-4 gap-4">

    <!-- Pending Column -->
    <div class="kanban-column bg-gray-50 rounded-2xl p-4 border border-gray-200">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-900 text-sm">Pending</h3>
        <span class="px-2.5 py-1 bg-gray-200 text-gray-700 text-xs font-bold rounded-lg">
          {{ tasks_by_status.pending|length }}
        </span>
      </div>

      <div class="space-y-3">
        {% for task in tasks_by_status.pending %}
        {% include 'tasks/_task_card.html' %}
        {% endfor %}
      </div>
    </div>

    <!-- In Progress Column -->
    <div class="kanban-column bg-purple-50 rounded-2xl p-4 border border-purple-200">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-900 text-sm">In Progress</h3>
        <span class="px-2.5 py-1 bg-purple-200 text-purple-700 text-xs font-bold rounded-lg">
          {{ tasks_by_status.in_progress|length }}
        </span>
      </div>

      <div class="space-y-3">
        {% for task in tasks_by_status.in_progress %}
        {% include 'tasks/_task_card.html' %}
        {% endfor %}
      </div>
    </div>

    <!-- On Hold Column -->
    <div class="kanban-column bg-orange-50 rounded-2xl p-4 border border-orange-200">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-900 text-sm">On Hold</h3>
        <span class="px-2.5 py-1 bg-orange-200 text-orange-700 text-xs font-bold rounded-lg">
          {{ tasks_by_status.on_hold|length }}
        </span>
      </div>

      <div class="space-y-3">
        {% for task in tasks_by_status.on_hold %}
        {% include 'tasks/_task_card.html' %}
        {% endfor %}
      </div>
    </div>

    <!-- Completed Column -->
    <div class="kanban-column bg-green-50 rounded-2xl p-4 border border-green-200">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-900 text-sm">Completed</h3>
        <span class="px-2.5 py-1 bg-green-200 text-green-700 text-xs font-bold rounded-lg">
          {{ tasks_by_status.completed|length }}
        </span>
      </div>

      <div class="space-y-3">
        {% for task in tasks_by_status.completed %}
        {% include 'tasks/_task_card.html' %}
        {% endfor %}
      </div>
    </div>

  </div>

  <!-- List View (Hidden by default) -->
  <div id="list-view" class="hidden space-y-3">
    {% for task in all_tasks %}
    <div class="bg-white rounded-xl border border-gray-200 p-5 hover:border-gray-400 transition-all shadow-sm">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-2 flex-wrap">
            <!-- Priority -->
            {% if task.priority == 'urgent' %}
            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-lg bg-red-50 text-red-700 text-xs font-medium">
              <span class="inline-block w-2 h-2 bg-red-500 rounded-full"></span>Urgent
            </span>
            {% elif task.priority == 'high' %}
            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-lg bg-orange-50 text-orange-700 text-xs font-medium">
              <span class="inline-block w-2 h-2 bg-orange-500 rounded-full"></span>High
            </span>
            {% elif task.priority == 'low' %}
            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-lg bg-blue-50 text-blue-700 text-xs font-medium">
              <span class="inline-block w-2 h-2 bg-blue-500 rounded-full"></span>Low
            </span>
            {% else %}
            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gray-100 text-gray-700 text-xs font-medium">
              <span class="inline-block w-2 h-2 bg-gray-400 rounded-full"></span>Medium
            </span>
            {% endif %}

            <!-- Status -->
            <span class="px-3 py-1 rounded-lg bg-gray-100 text-gray-700 text-xs font-medium">
              {{ task.status|replace('_', ' ')|title }}
            </span>

            <!-- Category -->
            {% if task.category %}
            <span class="px-3 py-1 rounded-lg bg-purple-50 text-purple-700 text-xs font-medium">
              {{ task.category|replace('_', ' ')|title }}
            </span>
            {% endif %}
          </div>

          <h3 class="text-base font-semibold text-gray-900 mb-2">{{ task.title }}</h3>

          <div class="flex items-center gap-4 text-xs text-gray-500">
            {% if task.due_date %}
            <span class="flex items-center gap-1">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              Due {{ task.due_date.strftime('%b %d') }}
            </span>
            {% endif %}
            {% if task.requester %}
            <span class="flex items-center gap-1">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              {{ task.requester }}
            </span>
            {% endif %}
            {% if task.progress > 0 %}
            <span class="flex items-center gap-1">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              {{ task.progress }}%
            </span>
            {% endif %}
          </div>
        </div>

        <a href="{{ url_for('tasks.task_detail', task_id=task.id) }}"
           class="px-4 py-2 rounded-lg bg-blue-50 text-blue-600 font-medium text-sm
                  hover:bg-blue-100 transition-all">
          View
        </a>
      </div>
    </div>
    {% endfor %}
  </div>

</div>

<script>
function switchView(view) {
  const kanbanView = document.getElementById('kanban-view');
  const listView = document.getElementById('list-view');
  const btnKanban = document.getElementById('btn-kanban');
  const btnList = document.getElementById('btn-list');

  if (view === 'kanban') {
    kanbanView.classList.remove('hidden');
    listView.classList.add('hidden');
    btnKanban.classList.add('bg-blue-500', 'text-white', 'shadow-sm');
    btnKanban.classList.remove('text-gray-600', 'hover:bg-gray-100');
    btnList.classList.remove('bg-blue-500', 'text-white', 'shadow-sm');
    btnList.classList.add('text-gray-600', 'hover:bg-gray-100');
  } else {
    kanbanView.classList.add('hidden');
    listView.classList.remove('hidden');
    btnList.classList.add('bg-blue-500', 'text-white', 'shadow-sm');
    btnList.classList.remove('text-gray-600', 'hover:bg-gray-100');
    btnKanban.classList.remove('bg-blue-500', 'text-white', 'shadow-sm');
    btnKanban.classList.add('text-gray-600', 'hover:bg-gray-100');
  }
}

function filterTasks(priority) {
  window.location.href = '?priority=' + priority;
}

function filterByCategory(category) {
  window.location.href = '?category=' + category;
}
</script>

{% endblock %}
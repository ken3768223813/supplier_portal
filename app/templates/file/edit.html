{% extends "layout/base.html" %}
{% block content %}

<div class="max-w-3xl mx-auto px-6 py-6">

  <div class="bg-white rounded-2xl border-2 border-gray-200 overflow-hidden">

    <!-- Header -->
    <div class="px-6 py-5 border-b border-gray-200 flex items-start justify-between gap-4">
      <div class="min-w-0">
        <h1 class="text-2xl font-bold text-gray-900">Edit File</h1>
        <p class="text-sm text-gray-500 mt-1 font-mono break-all">{{ file.original_name }}</p>
      </div>

      <div class="flex items-center gap-2 shrink-0">
        <a href="{{ url_for('file.view_file', file_id=file.id) }}" target="_blank"
           class="px-4 py-2 rounded-xl bg-blue-50 hover:bg-blue-100 text-blue-700 font-bold border-2 border-blue-200">
          View
        </a>
        <a href="{{ url_for('file.index') }}"
           class="px-4 py-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold">
          Back
        </a>
      </div>
    </div>

    <!-- Save Form -->
    <form method="post" class="p-6 space-y-5">

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Title</label>
        <input name="title" value="{{ file.title }}"
               class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Description</label>
        <textarea name="description" rows="3"
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">{{ file.description or '' }}</textarea>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-bold text-gray-700 mb-2">Category</label>
          <select name="category"
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
            {% for slug, info in categories.items() %}
              <option value="{{ slug }}" {% if file.category == slug %}selected{% endif %}>
                {{ info.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-2">Version</label>
          <input name="version" value="{{ file.version or '' }}"
                 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-2">Issue Date</label>
          <input type="date" name="issue_date"
                 value="{{ file.issue_date.strftime('%Y-%m-%d') if file.issue_date else '' }}"
                 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-2">Tags (comma)</label>
          <input name="tags" value="{{ file.tags or '' }}"
                 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-2">Related Process</label>
          <input name="related_process" value="{{ file.related_process or '' }}"
                 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-2">Supplier Name</label>
          <input name="supplier_name" value="{{ file.supplier_name or '' }}"
                 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
        </div>

        <div class="md:col-span-2">
          <label class="block text-sm font-bold text-gray-700 mb-2">Part Category</label>
          <input name="part_category" value="{{ file.part_category or '' }}"
                 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-gray-900 focus:outline-none">
        </div>
      </div>

      <div class="pt-2 flex items-center justify-between">
        <button type="submit"
                class="px-6 py-3 rounded-xl bg-gray-900 text-white font-bold hover:bg-gray-800">
          Save
        </button>

        <span class="text-xs text-gray-400 font-mono">
          ID: {{ file.id }}
        </span>
      </div>

    </form>

    <!-- Danger Zone (separate form, no nesting) -->
    <div class="px-6 pb-6">
      <div class="rounded-2xl border-2 border-red-200 bg-red-50 p-5 flex items-center justify-between gap-4">
        <div>
          <div class="text-sm font-bold text-red-700">Danger Zone</div>
          <div class="text-xs text-red-600 mt-1">Delete will remove DB record and the physical file.</div>
        </div>

        <form method="post" action="{{ url_for('file.delete_file', file_id=file.id) }}"
              onsubmit="return confirm('Delete file {{ file.title }}?');">
          <button type="submit"
                  class="px-6 py-3 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700">
            Delete
          </button>
        </form>
      </div>
    </div>

  </div>
</div>

{% endblock %}
